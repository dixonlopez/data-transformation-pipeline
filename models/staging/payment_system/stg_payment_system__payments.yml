version: 2

models:
  - name: stg_payment_system__payments
    description: "Staging model for payment transactions, cleaning and enriching raw payment data."
    columns:
      - name: payment_uid
        data_type: string
        description: "A unique identifier for each payment transaction, generated by hashing user, country, and transaction time."
        tests:
          - unique
          - not_null

      - name: user_id
        data_type: string
        description: "The unique identifier for the user who made the payment."
        tests:
          - not_null

      - name: billing_country
        data_type: string
        description: "The country where the billing occurred."
        tests:
          - not_null

      - name: transaction_time
        data_type: int64
        description: "The original transaction time in Unix timestamp format."

      - name: transaction_at
        data_type: timestamp
        description: "The timestamp of the transaction, converted to a BigQuery TIMESTAMP data type."

      - name: transaction_date
        data_type: date
        description: "The date of the transaction, extracted from transaction_at."

      - name: product
        data_type: string
        description: "The name or identifier of the product purchased."
        tests:
          - not_null

      - name: product_level
        data_type: int64
        description: "An integer representation of the hierarchical tier of the subscription product. Lower numbers indicate simpler/entry-level products (e.g., PRO=1), while higher numbers represent more comprehensive/advanced products (e.g., GURU=2, BUSINESS=3). This column facilitates the analysis of product upgrades and downgrades."
      

      - name: price_usd
        data_type: float64
        description: "The listed price of the service in USD."
        tests:
          - not_null

      - name: amount_paid_usd
        data_type: float64
        description: "The actual amount paid by the user after any discounts or charges."
        tests:
          - not_null

      - name: period
        data_type: int64
        description: "The billing period in months (e.g., 1 for monthly, 12 for annual)."
        tests:
          - not_null

      - name: gross_amount_usd
        data_type: numeric
        description: "The calculated gross amount (price * period) before applying any discounts or extra charges. This represents the expected revenue."
        tests:
          - not_null

      - name: discount_amount_usd
        data_type: numeric
        description: "The monetary value of any discount applied to the transaction. This will be zero if no discount was applied or an extra charge occurred."

      - name: extra_charge_amount_usd
        data_type: numeric
        description: "The monetary value of any extra charge applied to the transaction. This will be zero if no extra charge was applied or a discount occurred."

      - name: subscription_type
        data_type: string
        description: "Categorization of the subscription period (e.g., 'Annual', 'Monthly')."
        tests:
          - not_null
          - accepted_values:
              values: ['Annual', 'Monthly']

      - name: mrr_per_transaction_usd
        data_type: numeric
        description: "The Monthly Recurring Revenue (MRR) attributed to this specific transaction (amount / period)."