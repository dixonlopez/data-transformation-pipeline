version: 2

models:
  - name: stg_payment_system__payments
    description: "Staging model for raw payment data, cleaning and standardizing payment transactions."
    columns:
      - name: payment_uid
        description: "Unique identifier for each payment transaction, derived from user ID, billing country, and transaction time."
        tests:
          - unique
          - not_null
      - name: user_id
        description: "Unique identifier for the user."
        tests:
          - not_null
      - name: transaction_at
        description: "Timestamp of the payment transaction in UTC."
        tests:
          - not_null
      - name: product
        description: "Subscription product level (PRO, GURU, BUSINESS)."
        tests:
          - accepted_values:
              values: ["PRO", "GURU", "BUSINESS"]
      - name: product_level
        description: "Numeric representation of the product level (1=PRO, 2=GURU, 3=BUSINESS)."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 1
              max_value: 3
      - name: price_usd
        description: "Price of the product per month in USD."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: numeric
      - name: amount_paid_usd
        description: "Actual amount paid during the subscription period in USD."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: numeric
      - name: period
        description: "Duration of the subscription in months."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: int64
      - name: gross_amount_usd
        description: "Calculated gross amount (price * period) before any discounts."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: numeric
      - name: discount_amount_usd
        description: "Amount of discount applied to the transaction in USD."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: numeric
      - name: extra_charge_amount_usd
        description: "Any extra charge applied to the transaction in USD."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: numeric
      - name: subscription_type
        description: "Type of subscription (Annual, Monthly, Other)."
        tests:
          - accepted_values:
              values: ["Annual", "Monthly", "Other"]
      - name: mrr_per_transaction_usd
        description: "Monthly Recurring Revenue generated by this specific transaction in USD."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: numeric
