version: 2

models:
  - name: base_globepay__pay_acceptance_report
    description: "This model contains information about payment acceptance processed through the Globepay system. It provides details about the transaction, acceptance status, card verification, currencies involved, and amounts charged."
    columns:
      - name: payment_external_id
        data_type: varchar
        description: "Unique identifier for the payment assigned by the external system. Used to track payments across other systems and serves as a reference to the external transaction."
        data_tests:
          - not_null

      - name: source_system
        data_type: varchar
        description: "The source system that processed the payment. Indicates which system the transaction comes from (e.g., Globepay)."
        data_tests:
          - not_null

      - name: payment_internal_id
        data_type: varchar
        description: "Internal identifier for the payment within the Globepay system."

      - name: payment_key
        data_type: varchar
        description: "A surrogate key generated by combining the `payment_external_id` and `source_system`. Used to uniquely identify the payment transaction."
        data_tests:
          - dbt_constraints.primary_key

      - name: transaction_processed_at
        data_type: timestamp_ntz
        description: "Timestamp when the payment was processed by the system. Indicates when the transaction was finalized in the system."

      - name: was_transaction_accepted
        data_type: boolean
        description: "Indicates whether the payment was ACCEPTED (true) or DECLINED (false) by the payment processor."

      - name: was_card_verification_value_provided
        data_type: boolean
        description: "Indicates whether the card verification value (CVV) was provided during the transaction (true) or not (false)."

      - name: amount_charged_local_currency
        data_type: number
        description: "The amount charged in the local currency of the transaction. Represents the value deducted from the payerâ€™s card in their local currency."
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: '>= 0'
              config:
                  severity: warn          

      - name: iso_country_code
        data_type: varchar
        description: "ISO country code of the card issuer or payment origin. Represents the country of the payment method used."

      - name: iso_currency_code
        data_type: varchar
        description: "ISO currency code of the transaction. Represents the currency used in the payment (e.g., USD, EUR)."

      - name: rates_json
        data_type: varchar
        description: "JSON string containing exchange rates for various currencies. Used to convert the local currency to other currencies (e.g., USD, EUR)."

      - name: exchange_rate
        data_type: number
        description: "The exchange rate applied to convert the amount charged in local currency to the equivalent amount in USD."
        data_tests:
          - not_null

      - name: amount_charged_usd
        data_type: number
        description: "The amount charged in USD, converted from the local currency using the exchange rate."
